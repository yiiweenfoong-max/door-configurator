<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Door Configurator (Auto JSON Load)</title>
<style>
body {
    font-family: Arial, sans-serif;
    display: flex;
    padding: 20px;
    gap: 40px;
}
.door-preview {
    position: relative;
    width: 300px;
    height: 700px;
    border-top: 22px solid #333;
    border-left: 16px solid #333;
    border-right: 16px solid #333;
    border-bottom: none;
    background-color: #fff;
    box-sizing: border-box;
}
.laminate, .lock {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.lock {
    width: auto;
    height: 100px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
}
.controls {
    flex: 1;
}
.controls label, .controls input, .controls select, .controls button {
    display: block;
    margin-bottom: 10px;
}
.section-title {
    font-weight: bold;
    margin-top: 20px;
}
.thumbnail {
    width: 50px;
    height: 50px;
    object-fit: cover;
    margin: 3px;
    cursor: pointer;
    border: 1px solid #ccc;
}
.thumbnail.selected {
    border: 2px solid blue;
}
.thumbnails-container {
    display: flex;
    flex-wrap: wrap;
}
</style>
</head>
<body>

<div class="door-preview" id="door">
    <img id="laminate" class="laminate" src="" alt="Laminate">
    <img id="lock" class="lock" src="" alt="Lock">
</div>

<div class="controls">
    <div class="section-title">Laminate</div>
    <input type="file" id="laminateUpload" accept="image/*" multiple>
    <div id="laminateThumbs" class="thumbnails-container"></div>

    <div class="section-title">Lock</div>
    <input type="file" id="lockUpload" accept="image/*" multiple>
    <div id="lockThumbs" class="thumbnails-container"></div>

    <button id="saveJson">保存 JSON</button>
</div>

<script>
// -------------------------
// 全局变量
// -------------------------
let laminateList = [];
let lockList = [];
let laminateSelected = "";
let lockSelected = "";

// 元素
const laminateImg = document.getElementById("laminate");
const lockImg = document.getElementById("lock");
const laminateThumbs = document.getElementById("laminateThumbs");
const lockThumbs = document.getElementById("lockThumbs");

// -------------------------
// 自动加载 JSON
// -------------------------
const jsonUrl = "door-config.json";   // JSON 和 HTML 在同目录即可自动读取

async function loadJson() {
    try {
        const res = await fetch(jsonUrl);
        if (!res.ok) {
            console.log("暂无 JSON（第一次使用）");
            return;
        }
        const data = await res.json();

        // 恢复数据
        laminateList = data.laminateList || [];
        lockList = data.lockList || [];
        laminateSelected = data.laminateSelected || "";
        lockSelected = data.lockSelected || "";

        // 生成缩略图
        laminateList.forEach(url => addThumbnail(url, "laminate"));
        lockList.forEach(url => addThumbnail(url, "lock"));

        // 显示选中的 laminate
        if (laminateSelected) {
            laminateImg.src = laminateSelected;
            highlightSelected(laminateSelected, laminateThumbs);
        }

        // 显示选中的 lock
        if (lockSelected) {
            lockImg.src = lockSelected;
            highlightSelected(lockSelected, lockThumbs);
        }

        console.log("JSON 加载成功");

    } catch (err) {
        console.log("加载 JSON 失败：", err);
    }
}

// -------------------------
// 添加缩略图函数
// -------------------------
function addThumbnail(url, type) {
    const img = document.createElement("img");
    img.src = url;
    img.className = "thumbnail";

    img.onclick = () => {
        if (type === "laminate") {
            laminateSelected = url;
            laminateImg.src = url;
            highlightSelected(url, laminateThumbs);
        } else {
            lockSelected = url;
            lockImg.src = url;
            highlightSelected(url, lockThumbs);
        }
    };

    if (type === "laminate") {
        laminateThumbs.appendChild(img);
    } else {
        lockThumbs.appendChild(img);
    }
}

// -------------------------
// 高亮选择
// -------------------------
function highlightSelected(url, container) {
    container.querySelectorAll("img").forEach(img => {
        img.classList.toggle("selected", img.src === url);
    });
}

// -------------------------
// 上传 laminate
// -------------------------
document.getElementById("laminateUpload").addEventListener("change", e => {
    [...e.target.files].forEach(file => {
        const url = URL.createObjectURL(file);
        laminateList.push(url);
        addThumbnail(url, "laminate");
    });
});

// -------------------------
// 上传 lock
// -------------------------
document.getElementById("lockUpload").addEventListener("change", e => {
    [...e.target.files].forEach(file => {
        const url = URL.createObjectURL(file);
        lockList.push(url);
        addThumbnail(url, "lock");
    });
});

// -------------------------
// 保存 JSON
// -------------------------
document.getElementById("saveJson").onclick = () => {
    const data = {
        laminateList,
        lockList,
        laminateSelected,
        lockSelected
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], {
        type: "application/json"
    });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "door-config.json";
    a.click();
};

// -------------------------
// 自动启动：加载 JSON
// -------------------------
loadJson();

</script>
</body>
</html>
    
  </body>
  
</html>
